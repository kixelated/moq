<!doctype html>
<html lang="en" class="sl-theme-dark">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MoQ Demo</title>

	<!-- Use shoelace for some basic styling. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
	<script type="module"
		src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>
</head>

<body>
	<!-- Use the included custom element to render a preview. -->
	<hang-publish url="http://localhost:4443/demo/me" id="publish">
		<!-- Optionally provide a custom video element that we can style as needed -->
		<video style="max-width: 100%; height: auto; border-radius: 4px;" muted></video>
	</hang-publish>

	<!-- Make some simple controls to demonstate the API. -->
	<div style="display: flex; justify-content: center; gap: 16px; margin: 8px 0;">
		<div style="display: flex; align-items: center; gap: 8px;">
			<sl-spinner id="spinner"></sl-spinner>
			<span id="status">Initializing...</span>
		</div>

		<sl-radio-group>
			<sl-tooltip content="Publish your webcam." placement="bottom">
				<sl-radio-button id="camera">
					<sl-icon slot="prefix" name="camera" label="Camera" />
				</sl-radio-button>
			</sl-tooltip>

			<sl-tooltip content="Publish a screen or window." placement="bottom">
				<sl-radio-button id="screen">
					<sl-icon slot="prefix" name="display" label="Screen" />
				</sl-radio-button>
			</sl-tooltip>

			<sl-tooltip content="Publish nothing." placement="bottom">
				<sl-radio-button id="none">
					<sl-icon slot="prefix" name="x" label="None" />
				</sl-radio-button>
			</sl-tooltip>
		</sl-radio-group>

		<div style="display: flex; align-items: center; gap: 8px;">
			<a target="_blank" id="watch" style="visibility: hidden;">Watch</a>
		</div>
	</div>

	<h3>Tips:</h3>
	<ul>
		<li>Change the URL to watch a different broadcast. Or use query params to redirect this demo.
			<ul>
				<li>ex. <a href="?scheme=https&host=relay.quic.video">publish</a> and <a
						href="index.html?scheme=https&host=relay.quic.video">watch</a> over the internet.</li>
			</ul>
		</li>
	</ul>

	<h3>Other demos:</h3>
	<ul>
		<li><a href="index.html">Watch a broadcast.</a></li>
	</ul>
</body>

<script>
	// Yes this is a terrible mess and not how we make websites in >current year<.
	// But it's a demo, I'm lazy, and I don't want to require a build step.
	const publish = document.getElementById("publish");
	const camera = document.getElementById("camera");
	const screen = document.getElementById("screen");
	const none = document.getElementById("none");
	const status = document.getElementById("status");
	const watch = document.getElementById("watch");

	camera.addEventListener("click", () => publish.lib.device = "camera");
	screen.addEventListener("click", () => publish.lib.device = "screen");
	none.addEventListener("click", () => publish.lib.device = null);

	// If query params are provided, use them instead of the default.
	const urlParams = new URLSearchParams(window.location.search);
	const broadcast = urlParams.get("broadcast") ?? "demo/me";
	const host = urlParams.get("host") ?? "localhost:4443";
	const scheme = urlParams.get("scheme") ?? "http";

	publish.setAttribute("url", `${scheme}://${host}/${broadcast}`);
	watch.setAttribute("href", `index.html?broadcast=${broadcast}&host=${host}&scheme=${scheme}`);

	// Listen for connection status changes.
	publish.addEventListener("hang-publish-status", (event) => {
		if (event.detail === "connected") {
			status.textContent = "Connected";
			spinner.style.display = "none";
			watch.style.visibility = "visible";
		} else if (event.detail === "connecting") {
			status.textContent = "Connecting...";
			spinner.style.display = "block";
			watch.style.visibility = "hidden";
		} else if (event.detail === "disconnected") {
			status.textContent = "Disconnected";
			spinner.style.display = "none";
			watch.style.visibility = "hidden";
		} else if (event.detail === "live") {
			status.textContent = "Live";
			spinner.style.display = "none";
			watch.style.visibility = "visible";
		} else {
			throw new Error(`Unknown connection status: ${event.detail}`);
		}
	});
</script>

</html>