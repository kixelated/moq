<!doctype html>
<html lang="en" class="dark">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MoQ Demo</title>

	<link rel="stylesheet" href="index.css">
</head>

<body>
	<div id="container">
		<!-- Include the custom element to set up the canvas. -->
		<hang-watch url="http://localhost:4443/" name="demo/bbb" muted id="watch">
			<!-- Optionally provide a custom canvas element that we can style as needed -->
			<canvas style="max-width: 100%; height: auto; border-radius: 4px;"></canvas>
		</hang-watch>

		<!-- Make some "simple" controls to demonstate the API. -->
		<div style="justify-content: space-between; margin: 8px 0; gap: 8px; display: flex;">
			<button id="pause" title="Pause">
				‚è∏Ô∏è
			</button>

			<span>
				<button id="mute" title="Mute">üîá</button>
				<input type="range" id="volume" min=0 max=1 step=0.01 value=0 title="Volume"></input>
				<span id="volume-value">0%</span>
			</span>

			<span id="status">üü° Initializing...</span>

			<span title="Latency">
				‚è≥
				<input type="range" id="latency" min=0 max=4000 step=10 value=50></input>
				<span id="latency-value">50ms</span>
			</span>

			<button id="fullscreen" title="Fullscreen">‚õ∂</button>
		</div>
	</div>

	<h3>Other demos:</h3>
	<ul>
		<li><a href="publish.html">Publish a broadcast.</a></li>
	</ul>

	<h3>Tips:</h3>
	<p>
		Click the video to enable audio.
		This is not always necessary, but sometimes browsers require user interaction before autoplaying
		audio. If using the library directly, call <code class="language-typescript">watch.audio.init()</code> to try
		to reinitialize audio.
	</p>
	<p>
		You can use CSS to change the size of the canvas.
		Unfortunately, you can't use the HTML width/height attributes because of <a
			href="https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas">OffscreenCanvas</a>
		limitation.

		For example:
	<pre><code class="language-html">&lt;hang-watch url=&quot;http://localhost:4443/&quot; name=&quot;demo/bbb&quot;&gt;
	&lt;!-- Optionally provide a custom canvas element that we can style as needed --&gt;
	&lt;canvas style=&quot;max-width: 100%; height: auto; border-radius: 4px;&quot;&gt;&lt;/canvas&gt;
&lt;/hang-watch&gt;</code></pre>
	</p>
	<p>
		Media only flows over the network when needed!
		Video won't be downloaded when minimized/paused and audio won't be downloaded when muted or disabled.
		This extends to publishing as well, the client won't push media until at least 1 viewer wants it.
	</p>
	<p>
		You can instanciate the player via the provided <code class="language-html">&lt;hang-watch&gt;</code> <a
			href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components">Web Component</a>.
		Either modify HTML attributes like <code class="language-html">&lt;moq-watch paused&gt;</code>
		or access the element's Javascript API:
	<pre><code class="language-typescript">const watch = document.getElementById("watch");
watch.paused = true;
</code></pre>

	And of course you can use the Javascript API directly instead of the Web Component.
	It's a bit more complicated and subject to change, but it gives you raw <code
		class="language-typescript">VideoFrame</code> and <code class="language-typescript">AudioData</code> output.

	</p>
	<p>
		This demo supports query parameters to change the broadcast.
		Try running <code class="language-bash">just pub tos</code> in a new terminal and then <a
			href="index.html?name=demo/tos" target="_blank">watch the
			inferior test video</a>. The player also support automatically reloading broadcasts.
		Try running multiple terminals and kill the broadcast to see what happens.

	<pre><code class="language-bash"># Run the relay and web server in another terminal or the background.
just relay &
just web &

just pub bbb
# Kill it with ctrl+C

# Republish the same broadcast, the player will reconnect.
just pub bbb
		</code></pre>
	</p>
</body>

<script type="module" src="index.ts"></script>

</html>