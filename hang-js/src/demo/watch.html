<!doctype html>
<html lang="en" class="sl-theme-dark">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MoQ Demo</title>
	<style>
		body {
			margin: 0;
			padding: 16px;

			background-color: black;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		}

		code {
			padding: 2px 6px;
			background-color: #222;
			border-radius: 4px;
		}
	</style>

	<!-- Use shoelace for some basic styling. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
	<script type="module"
		src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>
</head>

<body>
	<div id="container">
		<!-- Include the custom element to set up the canvas. -->
		<hang-watch url="http://localhost:4443/demo/bbb" id="watch">
			<!-- Optionally provide a custom canvas element that we can style as needed -->
			<canvas style="max-width: 100%; height: auto; border-radius: 4px;"></canvas>
		</hang-watch>

		<!-- Make some simple controls to demonstate the API. -->
		<div style="justify-content: space-between; align-items: center; margin: 8px 0; gap: 8px; display: flex;">
			<div style="display: flex; gap: 8px;">
				<sl-button id="pause">
					<sl-icon name="pause" label="Pause" />
				</sl-button>

				<sl-dropdown placement="top-start" distance={2} hoist>
					<sl-button slot="trigger">
						<sl-icon name="volume-up" label="Volume" />
					</sl-button>

					<sl-menu>
						<sl-menu-item>
							<sl-range tooltip="none" id="volume" label="Volume" min=0 max=1 step=0.01 />
						</sl-menu-item>
					</sl-menu>
				</sl-dropdown>
			</div>

			<div style="display: flex; align-items: center; gap: 8px;">
				<sl-spinner id="spinner"></sl-spinner>
				<span id="status">Initializing...</span>
			</div>

			<div style="display: flex; gap: 8px;">
				<sl-button id="fullscreen">
					<sl-icon name="fullscreen" label="Fullscreen" />
				</sl-button>
			</div>
		</div>
	</div>

	<h3>Tips:</h3>
	<ul>
		<li>Click the video to enable audio.
			<ul>
				<li>This is not always necessary, but sometimes browsers require user interaction before autoplaying
					audio.</li>
				<li>If using the library directly, call <code>Watch.initAudio()</code> to try to reinitialize audio.
				</li>
			</ul>
		</li>
		<li>Data only flows over the network when needed.
			<ul>
				<li>Video won't be downloaded when minimized or paused.</li>
				<li>Audio won't be downloaded when muted or disabled.</li>
			</ul>
		</li>
		<li>You can use CSS to change the size of the canvas:
			<ul>
				<li>ex. <code>width: 100%</code> instead of <code>max-width: 100%</code>.</li>
				<li>You can't use the HTML width/height attributes because of <a
						href="https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas">OffscreenCanvas</a>
					limitations.</li>
			</ul>
		</li>
		<li>
			Change the URL to watch a different broadcast. Or use query params to redirect this demo.
			<ul>
				<li>ex. <code>just pub tos</code> then <a href="?broadcast=demo/tos">watch another video</a></li>
				<li>ex. <a href="?scheme=https&host=relay.quic.video">watch over the internet</a></li>
			</ul>
		</li>

		<li>
			You can modify the <code>&lt;moq-watch&gt;</code> attributes instead of using the JavaScript API.
			<ul>
				<li>ex. <code>&lt;moq-watch paused&gt;</code></li>
			</ul>
		</li>
	</ul>

	<h3>Other demos:</h3>
	<ul>
		<li><a href="publish.html">Publish a webcam or screen.</a></li>
	</ul>
</body>

<script>
	// Yes this is a terrible mess and not how we make websites in >current year<.
	// But it's a demo, I'm lazy, and I don't want to require a build step.
	const watch = document.getElementById("watch");
	const pause = document.getElementById("pause");
	const fullscreen = document.getElementById("fullscreen");
	const spinner = document.getElementById("spinner");
	const status = document.getElementById("status");
	const volume = document.getElementById("volume");
	const container = document.getElementById("container");

	// If query params are provided, use them as the broadcast URL instead of the default.
	const urlParams = new URLSearchParams(window.location.search);
	const broadcast = urlParams.get("broadcast") ?? "demo/bbb";
	const host = urlParams.get("host") ?? "localhost:4443";
	const scheme = urlParams.get("scheme") ?? "http";
	watch.setAttribute("url", `${scheme}://${host}/${broadcast}`);

	// Listen for clicks on the pause button.
	pause.addEventListener("click", () => {
		watch.lib.paused = !watch.lib.paused;
	});

	// Listen for clicks on the fullscreen button.
	let fullscreenActive = false;
	fullscreen.addEventListener("click", () => {
		if (fullscreenActive) {
			document.exitFullscreen();
		} else {
			container.requestFullscreen();
		}

		fullscreenActive = !fullscreenActive;
	});

	// Set the volume to 50% by default.
	volume.value = 0.50;

	// Listen for changes to the volume input.
	volume.addEventListener("sl-input", () => {
		watch.lib.volume = Number.parseFloat(volume.value);
	});

	// Listen for connection status changes.
	watch.addEventListener("hang-watch-status", (event) => {
		if (event.detail === "connected") {
			status.textContent = "Connected";
			spinner.style.display = "none";
		} else if (event.detail === "connecting") {
			status.textContent = "Connecting...";
			spinner.style.display = "block";
		} else if (event.detail === "disconnected") {
			status.textContent = "Disconnected";
			spinner.style.display = "none";
		} else if (event.detail === "live") {
			status.textContent = "Live";
			spinner.style.display = "none";
		} else if (event.detail === "offline") {
			status.textContent = "Offline";
			spinner.style.display = "none";
		} else {
			throw new Error(`Unknown connection status: ${event.detail}`);
		}
	});
</script>

</html>